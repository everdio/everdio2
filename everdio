#!/usr/bin/env php

<?php
\ini_set("memory_limit", "1536M");
\ini_set("display_errors", 1);

include_once(__DIR__ . \DIRECTORY_SEPARATOR . "everdio.php");

$cli = new \Component\Core\Controller\Model\Cli;
$cli->server = $_SERVER;
$cli->path = __DIR__;
$cli->setup();

echo $cli->echo("Everdio 2.0 ~ Command line interface", ["bold", "green", "underline"]) . \PHP_EOL . \PHP_EOL;
if (!isset($cli->route)) {
    echo $cli->echo("Nothing to execute", ["red"]) . \PHP_EOL . \PHP_EOL;    
    exit;
}

echo $cli->echo(\sprintf("Starting `%s`", $cli->route), ["yellow", "blackbg", "bold"]) . \PHP_EOL . \PHP_EOL;
try {
    echo $cli->execute(\DIRECTORY_SEPARATOR . $cli->route) . \PHP_EOL;
} catch (\LogicException $ex) {
    if (isset($cli->request->_debug)) {
        throw new \RuntimeException($ex->getMessage(), 0, $ex);
    }

    echo $cli->echo(\sprintf("Exception; %s", $ex->getMessage()), ["yellow", "blackbg", "bold"]) . \PHP_EOL;
}

echo $cli->echo(\sprintf("Finnished in %ss with max %s memory...", $cli->getTime(), $cli->getMemory()), ["bold", "yellow"]) . \PHP_EOL;
exit;