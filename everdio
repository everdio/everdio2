#!/usr/bin/env php

<?php
\ini_set("memory_limit", "1536M");
\ini_set("display_errors", 1);

include_once(__DIR__ . \DIRECTORY_SEPARATOR . "everdio.php");

$cli = new \Component\Core\Controller\Model\Cli;
$cli->pm = "php";
$cli->server = $_SERVER;
$cli->path = __DIR__;
$cli->debug = "_debug";
$cli->setup();
$cli->throttle();

$cli->echo("Everdio2 CommandLine", ["yellow", "bold", "underline"]);
$cli->break(2);
if (!isset($cli->execute)) {
    $cli->echo("Provide a valid execute path ..", ["lightgray", "bold"]);
    $cli->break(2);
    exit;
}


$cli->echo("Processing ", ["lightgray"]);
$cli->echo(\sprintf("`%s`", $cli->execute), ["green"]);
$cli->echo(" at ", ["lightgrey"]);
$cli->echo(\sprintf("`%s`", \date("Y-m-d H:i:s")), ["green"]);
$cli->echo(" with pid ", ["lightgrey"]);
$cli->echo(\sprintf("`%s`", $cli->pid), ["green"]);
$cli->break(2);

try {
    $cli->execute(\DIRECTORY_SEPARATOR . $cli->execute);
} catch (\Exception $ex) {
    if (isset($cli->request->{$cli->debug})) {
        throw new \RuntimeException($ex->getMessage(), 0, $ex);
    }
    $cli->break(1);
    $cli->echo($ex->getMessage(), ["red", "bold"]);
    $cli->break(1);
}

$cli->break();
$cli->echo(\sprintf("Done in %ss with %s memory consumption", $cli->getTimer(), $cli->getSizeformat(\memory_get_peak_usage(true))), ["lightgray"]);
$cli->break(2);
exit;